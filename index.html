<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicadores 310 Barber</title>
    
    <!-- Meta Tags B√°sicos -->
    <meta name="theme-color" content="#4a4a4a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="310 Barber">
    <meta name="description" content="Sistema de indicadores para barbearia 310 - Calcule faturamento, comiss√µes e m√©tricas de desempenho">
    
    <!-- √çcone Simples -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='4' fill='%234a4a4a'/><circle cx='16' cy='16' r='8' fill='%23f0f0f0'/><text x='16' y='20' text-anchor='middle' fill='%234a4a4a' font-size='10' font-weight='bold'>310</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4a4a4a, #5a5a5a);
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(80, 80, 80, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }

        .header {
            background: linear-gradient(135deg, #5a5a5a, #4a4a4a);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #888888;
            transition: all 0.3s ease;
            position: relative;
        }

        .header:hover {
            background: linear-gradient(135deg, #606060, #505050);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #f0f0f0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .header h1:hover {
            transform: scale(1.05);
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
        }

        .header p {
            color: #cccccc;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }

        .header p:hover {
            color: #ffffff;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .input-section, .results-section {
            background: rgba(70, 70, 70, 0.8);
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #888888;
            transition: all 0.4s ease;
            animation: slideInUp 0.8s ease-out;
        }

        .input-section:hover, .results-section:hover {
            background: rgba(75, 75, 75, 0.9);
            border-color: #aaaaaa;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
            animation: slideInUp 0.6s ease-out;
            animation-fill-mode: both;
        }

        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #cccccc;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }

        .form-group:hover label {
            color: #ffffff;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #888888;
            border-radius: 8px;
            background: rgba(240, 240, 240, 0.1);
            color: #f0f0f0;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        input:hover {
            border-color: #aaaaaa;
            background: rgba(240, 240, 240, 0.12);
            transform: translateY(-1px);
        }

        input:focus {
            outline: none;
            border-color: #cccccc;
            background: rgba(240, 240, 240, 0.15);
            box-shadow: 0 0 15px rgba(204, 204, 204, 0.4);
            transform: translateY(-2px) scale(1.02);
        }

        input::placeholder {
            color: #aaaaaa;
            transition: color 0.3s ease;
        }

        input:focus::placeholder {
            color: #cccccc;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #f0f0f0;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #888888;
            transition: all 0.3s ease;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #aaaaaa, #cccccc);
            transition: all 0.4s ease;
            transform: translateX(-50%);
        }

        .section-title:hover::after {
            width: 100%;
        }

        .barbeiro-section {
            background: rgba(80, 80, 80, 0.6);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid #aaaaaa;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .barbeiro-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .barbeiro-section:hover {
            background: rgba(85, 85, 85, 0.7);
            border-left-color: #cccccc;
            transform: translateX(5px);
        }

        .barbeiro-section:hover::before {
            left: 100%;
        }

        .barbeiro-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #cccccc;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .barbeiro-section:hover .barbeiro-title {
            color: #ffffff;
            transform: translateX(5px);
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #888888, #aaaaaa);
            color: #2a2a2a;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .calculate-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }

        .calculate-btn:hover {
            background: linear-gradient(135deg, #aaaaaa, #cccccc);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            animation: pulse 0.6s ease-in-out;
        }

        .calculate-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .calculate-btn:active {
            transform: translateY(-1px);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .results {
            background: rgba(70, 70, 70, 0.9);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #888888;
            font-family: 'Courier New', monospace;
            white-space: pre-line;
            line-height: 1.6;
            color: #f0f0f0;
            transition: all 0.3s ease;
            position: relative;
        }

        .results:hover {
            background: rgba(75, 75, 75, 0.95);
            border-color: #aaaaaa;
        }

        .copy-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #aaaaaa, #888888);
            color: #2a2a2a;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }

        .copy-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .copy-btn:hover {
            background: linear-gradient(135deg, #cccccc, #aaaaaa);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .copy-btn:hover::before {
            width: 200px;
            height: 200px;
        }

        .copy-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71) !important;
            color: white !important;
            animation: pulse 0.4s ease-in-out;
        }

        /* Dashboard Styles */
        .dashboard {
            display: none;
            grid-template-columns: 1fr;
            gap: 20px;
            padding: 30px;
            animation: slideInUp 0.8s ease-out;
        }

        .dashboard.active {
            display: grid;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #4a5568;
            animation: scaleIn 0.6s ease-out;
        }

        .dashboard-date {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ecf0f1;
            margin-bottom: 10px;
        }

        .dashboard-subtitle {
            color: #bdc3c7;
            font-size: 1.1rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            animation: slideInUp 0.8s ease-out;
            animation-delay: 0.2s;
            animation-fill-mode: both;
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(70, 70, 70, 0.9), rgba(80, 80, 80, 0.9));
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #888888;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: #aaaaaa;
        }

        .metric-card:hover::before {
            left: 100%;
        }

        .metric-card.highlight {
            border: 2px solid #27ae60;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(46, 204, 113, 0.1));
        }

        .metric-card.warning {
            border: 2px solid #f39c12;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(230, 126, 34, 0.1));
        }

        .metric-title {
            font-size: 0.9rem;
            color: #bdc3c7;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ecf0f1;
            margin-bottom: 5px;
        }

        .metric-card.highlight .metric-value {
            color: #2ecc71;
        }

        .metric-card.warning .metric-value {
            color: #f39c12;
        }

        .metric-subtitle {
            font-size: 0.8rem;
            color: #95a5a6;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            animation: slideInUp 0.8s ease-out;
            animation-delay: 0.4s;
            animation-fill-mode: both;
        }

        .chart-container {
            background: rgba(70, 70, 70, 0.9);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #888888;
            transition: all 0.4s ease;
        }

        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            border-color: #aaaaaa;
        }

        .chart-title {
            font-size: 1.2rem;
            color: #ecf0f1;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .bar-chart {
            display: flex;
            align-items: end;
            justify-content: space-around;
            height: 200px;
            margin-bottom: 15px;
        }

        .bar {
            background: linear-gradient(to top, #3498db, #5dade2);
            border-radius: 4px 4px 0 0;
            min-width: 40px;
            margin: 0 5px;
            position: relative;
            transition: all 0.4s ease;
            animation: growUp 1s ease-out;
            animation-fill-mode: both;
        }

        .bar:nth-child(1) { animation-delay: 0.1s; }
        .bar:nth-child(2) { animation-delay: 0.2s; }
        .bar:nth-child(3) { animation-delay: 0.3s; }

        .bar:hover {
            transform: scale(1.05);
            background: linear-gradient(to top, #2980b9, #3498db);
        }

        .bar-victor { background: linear-gradient(to top, #2c3e50, #34495e); }
        .bar-fernando { background: linear-gradient(to top, #7f8c8d, #95a5a6); }
        .bar-ygor { background: linear-gradient(to top, #ecf0f1, #bdc3c7); }

        .bar-victor:hover { background: linear-gradient(to top, #1a252f, #2c3e50); }
        .bar-fernando:hover { background: linear-gradient(to top, #6c7b7d, #7f8c8d); }
        .bar-ygor:hover { background: linear-gradient(to top, #d5dbdb, #ecf0f1); }

        @keyframes growUp {
            from {
                height: 0;
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #bdc3c7;
            white-space: nowrap;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: #ecf0f1;
            font-weight: bold;
            white-space: nowrap;
        }

        .donut-chart {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .donut-segment {
            transition: all 0.3s ease;
        }

        .donut-segment:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
        }

        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #ecf0f1;
        }

        .donut-center-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .donut-center-label {
            font-size: 0.8rem;
            color: #bdc3c7;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #bdc3c7;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            animation: slideInUp 0.8s ease-out;
            animation-delay: 0.6s;
            animation-fill-mode: both;
        }

        .performance-card {
            background: rgba(60, 60, 60, 0.9);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            transition: all 0.4s ease;
        }

        .performance-card:hover {
            transform: translateX(5px);
            background: rgba(70, 70, 70, 0.9);
        }

        .performance-card.victor { border-left-color: #2c3e50; }
        .performance-card.fernando { border-left-color: #7f8c8d; }
        .performance-card.ygor { border-left-color: #ecf0f1; }

        .performance-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ecf0f1;
            margin-bottom: 15px;
        }

        .performance-metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .performance-label {
            color: #bdc3c7;
        }

        .performance-value {
            color: #ecf0f1;
            font-weight: 600;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(52, 73, 94, 0.9);
            color: #ecf0f1;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .back-btn:hover {
            background: rgba(44, 62, 80, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .download-section {
            margin-top: 30px;
            text-align: center;
            animation: slideInUp 0.8s ease-out;
            animation-delay: 0.8s;
            animation-fill-mode: both;
        }

        .download-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .download-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
            animation: pulse 0.6s ease-in-out;
        }

        .download-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .download-btn:active {
            transform: translateY(-1px);
        }

        .download-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .download-btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header {
                padding: 20px;
            }
            
            .theme-toggle {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }

            .charts-section {
                grid-template-columns: 1fr;
            }

            .performance-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .back-btn {
                top: 15px;
                left: 15px;
                padding: 10px 16px;
                font-size: 0.8rem;
            }
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
            animation: slideInUp 0.3s ease-out;
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(231, 76, 60, 0.15);
            border-left: 4px solid #e74c3c;
            position: relative;
        }

        .error-message::before {
            content: '‚ö†Ô∏è';
            margin-right: 8px;
            font-size: 1rem;
        }

        .input-error {
            border-color: #e74c3c !important;
            background: rgba(231, 76, 60, 0.1) !important;
            animation: shake 0.5s ease-in-out;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.3) !important;
        }

        /* Tema Claro */
        body.light-theme {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #2c3e50;
        }

        body.light-theme .container {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        body.light-theme .header {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-bottom: 3px solid #dee2e6;
        }

        body.light-theme .header h1 {
            color: #2c3e50;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        body.light-theme .header p {
            color: #6c757d;
        }

        body.light-theme .input-section,
        body.light-theme .results-section {
            background: rgba(248, 249, 250, 0.8);
            border: 1px solid #dee2e6;
        }

        body.light-theme .input-section:hover,
        body.light-theme .results-section:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: #adb5bd;
        }

        body.light-theme .section-title {
            color: #2c3e50;
            border-bottom: 2px solid #dee2e6;
        }

        body.light-theme .barbeiro-section {
            background: rgba(255, 255, 255, 0.6);
            border-left: 4px solid #6c757d;
        }

        body.light-theme .barbeiro-section:hover {
            background: rgba(255, 255, 255, 0.8);
            border-left-color: #495057;
        }

        body.light-theme .barbeiro-title {
            color: #495057;
        }

        body.light-theme label {
            color: #495057;
        }

        body.light-theme input {
            background: rgba(255, 255, 255, 0.8);
            color: #2c3e50;
            border: 2px solid #dee2e6;
        }

        body.light-theme input:hover {
            border-color: #adb5bd;
            background: rgba(255, 255, 255, 0.9);
        }

        body.light-theme input:focus {
            border-color: #6c757d;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 15px rgba(108, 117, 125, 0.3);
        }

        body.light-theme input::placeholder {
            color: #6c757d;
        }

        body.light-theme .results {
            background: rgba(248, 249, 250, 0.9);
            color: #2c3e50;
            border: 1px solid #dee2e6;
        }

        body.light-theme .theme-toggle {
            background: rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(0, 0, 0, 0.2);
        }

        body.light-theme .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.2);
            border-color: rgba(0, 0, 0, 0.4);
        }

        /* Dashboard Light Theme */
        body.light-theme .dashboard-header {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border: 2px solid #dee2e6;
        }

        body.light-theme .dashboard-date {
            color: #2c3e50;
        }

        body.light-theme .dashboard-subtitle {
            color: #6c757d;
        }

        body.light-theme .metric-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 249, 250, 0.9));
            border: 1px solid #dee2e6;
        }

        body.light-theme .metric-card:hover {
            border-color: #adb5bd;
        }

        body.light-theme .metric-title {
            color: #6c757d;
        }

        body.light-theme .metric-value {
            color: #2c3e50;
        }

        body.light-theme .metric-subtitle {
            color: #6c757d;
        }

        body.light-theme .chart-container {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #dee2e6;
        }

        body.light-theme .chart-title {
            color: #2c3e50;
        }

        body.light-theme .performance-card {
            background: rgba(255, 255, 255, 0.9);
        }

        body.light-theme .performance-name {
            color: #2c3e50;
        }

        body.light-theme .performance-label {
            color: #6c757d;
        }

        body.light-theme .performance-value {
            color: #2c3e50;
        }

        body.light-theme .back-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
            border: 1px solid #dee2e6;
        }

        body.light-theme .back-btn:hover {
            background: rgba(248, 249, 250, 0.9);
            border-color: #adb5bd;
        }

        body.light-theme .download-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.2);
        }

        body.light-theme .download-btn:hover {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        body.light-theme .comissao-hint {
            color: #6c757d !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .success-message {
            color: #27ae60;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
            animation: slideInUp 0.3s ease-out;
            padding: 5px;
            border-radius: 4px;
            background: rgba(39, 174, 96, 0.1);
            border-left: 3px solid #27ae60;
        }

        /* Melhorias de acessibilidade */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus indicators melhorados */
        button:focus-visible,
        input:focus-visible {
            outline: 3px solid #cccccc;
            outline-offset: 2px;
        }

        /* Indicador de loading */
        .loading {
            opacity: 0.7;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid #cccccc;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="alternarTema()" aria-label="Alternar entre tema claro e escuro">
                <span id="theme-icon">üåô</span>
            </button>
            <h1>Indicadores 310 Barber</h1>
            <p>dc:elevensrn</p>
        </div>

        <!-- Formul√°rio de Entrada -->
        <div class="content" id="inputContent">
            <div class="input-section">
                <h2 class="section-title">Dados de Entrada</h2>
                
                <div class="form-group">
                    <label for="dia">Dia/M√™s:</label>
                    <input type="text" id="dia" placeholder="Ex: 09/08" aria-label="Data no formato dia/m√™s" aria-describedby="dia-help">
                    <div class="error-message" id="dia-error" role="alert"></div>
                    <div class="sr-only" id="dia-help">Digite a data no formato DD/MM</div>
                </div>

                <div class="barbeiro-section" role="group" aria-labelledby="victor-title">
                    <h3 class="barbeiro-title" id="victor-title">Victor</h3>
                    <div class="form-group">
                        <label for="victorFat">Faturamento Victor (R$):</label>
                        <input type="number" id="victorFat" step="0.01" min="0" max="999999" placeholder="0.00" aria-label="Faturamento do barbeiro Victor em reais" aria-describedby="victorFat-help">
                        <div class="error-message" id="victorFat-error" role="alert"></div>
                        <div class="sr-only" id="victorFat-help">Digite o valor do faturamento em reais</div>
                    </div>
                    <div class="form-group">
                        <label for="victorCA">Clientes atendidos Victor:</label>
                        <input type="number" id="victorCA" min="0" max="1000" placeholder="0" aria-label="N√∫mero de clientes atendidos pelo Victor" aria-describedby="victorCA-help">
                        <div class="error-message" id="victorCA-error" role="alert"></div>
                        <div class="sr-only" id="victorCA-help">Digite o n√∫mero de clientes atendidos</div>
                    </div>
                    <div class="form-group">
                        <label for="victorCN">Clientes novos Victor:</label>
                        <input type="number" id="victorCN" min="0" max="1000" placeholder="0" aria-label="N√∫mero de clientes novos do Victor" aria-describedby="victorCN-help">
                        <div class="error-message" id="victorCN-error" role="alert"></div>
                        <div class="sr-only" id="victorCN-help">Digite o n√∫mero de clientes novos</div>
                    </div>
                </div>

                <div class="barbeiro-section" role="group" aria-labelledby="fernando-title">
                    <h3 class="barbeiro-title" id="fernando-title">Fernando</h3>
                    <div class="form-group">
                        <label for="fernandoFat">Faturamento Fernando (R$):</label>
                        <input type="number" id="fernandoFat" step="0.01" min="0" max="999999" placeholder="0.00" aria-label="Faturamento do barbeiro Fernando em reais" aria-describedby="fernandoFat-help">
                        <div class="error-message" id="fernandoFat-error" role="alert"></div>
                        <div class="sr-only" id="fernandoFat-help">Digite o valor do faturamento em reais</div>
                    </div>
                    <div class="form-group">
                        <label for="fernandoCA">Clientes atendidos Fernando:</label>
                        <input type="number" id="fernandoCA" min="0" max="1000" placeholder="0" aria-label="N√∫mero de clientes atendidos pelo Fernando" aria-describedby="fernandoCA-help">
                        <div class="error-message" id="fernandoCA-error" role="alert"></div>
                        <div class="sr-only" id="fernandoCA-help">Digite o n√∫mero de clientes atendidos</div>
                    </div>
                    <div class="form-group">
                        <label for="fernandoCN">Clientes novos Fernando:</label>
                        <input type="number" id="fernandoCN" min="0" max="1000" placeholder="0" aria-label="N√∫mero de clientes novos do Fernando" aria-describedby="fernandoCN-help">
                        <div class="error-message" id="fernandoCN-error" role="alert"></div>
                        <div class="sr-only" id="fernandoCN-help">Digite o n√∫mero de clientes novos</div>
                    </div>
                </div>

                <div class="barbeiro-section" role="group" aria-labelledby="ygor-title">
                    <h3 class="barbeiro-title" id="ygor-title">Ygor</h3>
                    <div class="form-group">
                        <label for="ygorFat">Faturamento Ygor (R$):</label>
                        <input type="number" id="ygorFat" step="0.01" min="0" max="999999" placeholder="0.00" aria-label="Faturamento do barbeiro Ygor em reais" aria-describedby="ygorFat-help">
                        <div class="error-message" id="ygorFat-error" role="alert"></div>
                        <div class="sr-only" id="ygorFat-help">Digite o valor do faturamento em reais</div>
                    </div>
                    <div class="form-group">
                        <label for="ygorComissao">Comiss√£o Ygor (R$):</label>
                        <input type="number" id="ygorComissao" step="0.01" min="0" max="999999" placeholder="0.00" aria-label="Valor da comiss√£o do Ygor em reais" aria-describedby="ygorComissao-help">
                        <div class="error-message" id="ygorComissao-error" role="alert"></div>
                        <div class="sr-only" id="ygorComissao-help">Digite o valor da comiss√£o em reais (calculado automaticamente como 55% do faturamento)</div>
                        <div class="comissao-hint" style="font-size: 0.8rem; color: #aaaaaa; margin-top: 5px;">
                            üí° Calculado automaticamente como 55% do faturamento. Ajuste se houver venda de produtos.
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ygorCA">Clientes atendidos Ygor:</label>
                        <input type="number" id="ygorCA" min="0" max="1000" placeholder="0" aria-label="N√∫mero de clientes atendidos pelo Ygor" aria-describedby="ygorCA-help">
                        <div class="error-message" id="ygorCA-error" role="alert"></div>
                        <div class="sr-only" id="ygorCA-help">Digite o n√∫mero de clientes atendidos</div>
                    </div>
                    <div class="form-group">
                        <label for="ygorCN">Clientes novos Ygor:</label>
                        <input type="number" id="ygorCN" min="0" max="1000" placeholder="0" aria-label="N√∫mero de clientes novos do Ygor" aria-describedby="ygorCN-help">
                        <div class="error-message" id="ygorCN-error" role="alert"></div>
                        <div class="sr-only" id="ygorCN-help">Digite o n√∫mero de clientes novos</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="totalDespesas">Despesas 310 (R$):</label>
                    <input type="number" id="totalDespesas" step="0.01" min="0" max="999999" placeholder="0.00" aria-label="Total de despesas da barbearia 310 em reais" aria-describedby="totalDespesas-help">
                    <div class="error-message" id="totalDespesas-error" role="alert"></div>
                    <div class="sr-only" id="totalDespesas-help">Digite o valor total das despesas em reais</div>
                </div>

                <button class="calculate-btn" onclick="calcularIndicadores()" aria-describedby="calc-help">
                    <span class="sr-only" id="calc-help">Clique para processar os dados e gerar o relat√≥rio de indicadores</span>
                    Calcular Indicadores
                </button>
            </div>

            <div class="results-section">
                <h2 class="section-title">Resultados</h2>
                <div class="results" id="resultados" role="region" aria-label="Resultados dos indicadores calculados" aria-live="polite">
                    Preencha os dados e clique em "Calcular Indicadores" para ver os resultados.
                </div>
                <button class="copy-btn" id="copyBtn" onclick="copiarResultados()" style="display: none;" aria-label="Copiar resultados para √°rea de transfer√™ncia">
                    üìã Copiar para √Årea de Transfer√™ncia
                </button>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <button class="back-btn" onclick="voltarFormulario()">‚Üê Voltar ao Formul√°rio</button>
            
            <div class="dashboard-header">
                <div class="dashboard-date" id="dashboardDate"></div>
                <div class="dashboard-subtitle">Dashboard de Indicadores - 310 Barber</div>
            </div>

            <div class="metrics-grid" id="metricsGrid">
                <!-- M√©tricas ser√£o inseridas dinamicamente -->
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-title">Faturamento por Barbeiro</div>
                    <div class="bar-chart" id="faturamentoChart">
                        <!-- Gr√°fico de barras ser√° inserido dinamicamente -->
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Distribui√ß√£o de Clientes</div>
                    <div class="donut-chart" id="clientesChart">
                        <!-- Gr√°fico de rosca ser√° inserido dinamicamente -->
                    </div>
                    <div class="legend" id="clientesLegend">
                        <!-- Legenda ser√° inserida dinamicamente -->
                    </div>
                </div>
            </div>

            <div class="performance-grid" id="performanceGrid">
                <!-- Cards de performance ser√£o inseridos dinamicamente -->
            </div>

            <div class="download-section">
                <button class="download-btn" onclick="baixarDashboardPNG()" aria-label="Baixar dashboard como imagem PNG">
                    üì∏ Baixar Dashboard como PNG
                </button>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais para armazenar dados
        let dadosCalculados = {};

        // Fun√ß√£o para calcular comiss√£o automaticamente
        function calcularComissaoYgor() {
            const ygorFat = parseFloat(document.getElementById('ygorFat').value) || 0;
            const ygorComissao = document.getElementById('ygorComissao');
            
            if (ygorFat > 0) {
                const comissaoCalculada = ygorFat * 0.55;
                ygorComissao.value = comissaoCalculada.toFixed(2);
                
                // Adicionar feedback visual tempor√°rio
                ygorComissao.style.backgroundColor = 'rgba(39, 174, 96, 0.1)';
                ygorComissao.style.borderColor = '#27ae60';
                
                setTimeout(() => {
                    ygorComissao.style.backgroundColor = '';
                    ygorComissao.style.borderColor = '';
                }, 1500);
            } else {
                ygorComissao.value = '';
            }
        }

        // Fun√ß√£o para validar entrada
        function validarCampo(campo, valor, tipo, min = 0, max = Infinity) {
            const errorElement = document.getElementById(campo + '-error');
            const inputElement = document.getElementById(campo);
            
            // Limpar erros anteriores
            errorElement.style.display = 'none';
            inputElement.classList.remove('input-error');
            
            if (valor === '' || valor === null) {
                return true; // Campos vazios s√£o permitidos (valor padr√£o 0)
            }
            
            if (tipo === 'number') {
                const num = parseFloat(valor);
                if (isNaN(num)) {
                    mostrarErro(campo, 'Digite apenas n√∫meros');
                    return false;
                }
                if (num < min) {
                    mostrarErro(campo, `Valor deve ser maior ou igual a ${min}`);
                    return false;
                }
                if (num > max) {
                    mostrarErro(campo, `Valor deve ser menor ou igual a ${max}`);
                    return false;
                }
            }
            
            if (tipo === 'date') {
                const dateRegex = /^\d{2}\/\d{2}$/;
                if (!dateRegex.test(valor)) {
                    mostrarErro(campo, 'Use o formato DD/MM');
                    return false;
                }
                
                const [dia, mes] = valor.split('/').map(Number);
                if (dia < 1 || dia > 31) {
                    mostrarErro(campo, 'Dia deve estar entre 1 e 31');
                    return false;
                }
                if (mes < 1 || mes > 12) {
                    mostrarErro(campo, 'M√™s deve estar entre 1 e 12');
                    return false;
                }
            }
            
            return true;
        }
        
        function mostrarErro(campo, mensagem) {
            const errorElement = document.getElementById(campo + '-error');
            const inputElement = document.getElementById(campo);
            
            errorElement.textContent = mensagem;
            errorElement.style.display = 'block';
            inputElement.classList.add('input-error');
            
            // Anunciar erro para leitores de tela
            inputElement.setAttribute('aria-invalid', 'true');
            
            // Remover erro ap√≥s 5 segundos
            setTimeout(() => {
                errorElement.style.display = 'none';
                inputElement.classList.remove('input-error');
                inputElement.setAttribute('aria-invalid', 'false');
            }, 5000);
        }
        
        function validarTodosOsCampos() {
            let todosValidos = true;
            
            const campos = [
                { id: 'dia', tipo: 'date' },
                { id: 'victorFat', tipo: 'number', max: 999999 },
                { id: 'victorCA', tipo: 'number', max: 1000 },
                { id: 'victorCN', tipo: 'number', max: 1000 },
                { id: 'fernandoFat', tipo: 'number', max: 999999 },
                { id: 'fernandoCA', tipo: 'number', max: 1000 },
                { id: 'fernandoCN', tipo: 'number', max: 1000 },
                { id: 'ygorFat', tipo: 'number', max: 999999 },
                { id: 'ygorComissao', tipo: 'number', max: 999999 },
                { id: 'ygorCA', tipo: 'number', max: 1000 },
                { id: 'ygorCN', tipo: 'number', max: 1000 },
                { id: 'totalDespesas', tipo: 'number', max: 999999 }
            ];
            
            campos.forEach(campo => {
                const valor = document.getElementById(campo.id).value;
                if (!validarCampo(campo.id, valor, campo.tipo, 0, campo.max)) {
                    todosValidos = false;
                }
            });
            
            return todosValidos;
        }

        function calcularIndicadores() {
            // Adicionar indicador de loading
            const btn = document.querySelector('.calculate-btn');
            btn.classList.add('loading');
            btn.disabled = true;
            
            // Validar todos os campos primeiro
            if (!validarTodosOsCampos()) {
                btn.classList.remove('loading');
                btn.disabled = false;
                return;
            }
            
            // Simular pequeno delay para mostrar loading
            setTimeout(() => {
                // Coletando dados
                const dia = document.getElementById('dia').value || new Date().toLocaleDateString('pt-BR').slice(0, 5);
                
                const victorFat = parseFloat(document.getElementById('victorFat').value) || 0;
                const victorCA = parseInt(document.getElementById('victorCA').value) || 0;
                const victorCN = parseInt(document.getElementById('victorCN').value) || 0;
                
                const fernandoFat = parseFloat(document.getElementById('fernandoFat').value) || 0;
                const fernandoCA = parseInt(document.getElementById('fernandoCA').value) || 0;
                const fernandoCN = parseInt(document.getElementById('fernandoCN').value) || 0;
                
                const ygorFat = parseFloat(document.getElementById('ygorFat').value) || 0;
                const ygorComissao = parseFloat(document.getElementById('ygorComissao').value) || 0;
                const ygorCA = parseInt(document.getElementById('ygorCA').value) || 0;
                const ygorCN = parseInt(document.getElementById('ygorCN').value) || 0;
                
                const totalDespesas = parseFloat(document.getElementById('totalDespesas').value) || 0;
            
                // Capacidade total da barbearia
                const capacidadeTotal = 10;
                
                // C√°lculo dos totais
                const totalFat = victorFat + fernandoFat + ygorFat;
                const totalCA = victorCA + fernandoCA + ygorCA;
                const totalCN = victorCN + fernandoCN + ygorCN;
                const totalComissao = ygorComissao;
                const totalMC = totalFat - totalComissao;
                const totalGC = totalMC - totalDespesas;
                const totalTO = totalCA !== 0 ? (totalCA / 30) * 100 : 0;
                const totalTM = totalCA !== 0 ? totalFat / totalCA : 0;
                
                // C√°lculo dos indicadores individuais
                const victorTM = victorCA !== 0 ? victorFat / victorCA : 0;
                const victorTO = capacidadeTotal !== 0 ? (victorCA / capacidadeTotal) * 100 : 0;
                
                const fernandoTM = fernandoCA !== 0 ? fernandoFat / fernandoCA : 0;
                const fernandoTO = capacidadeTotal !== 0 ? (fernandoCA / capacidadeTotal) * 100 : 0;
                
                const ygorTM = ygorCA !== 0 ? ygorFat / ygorCA : 0;
                const ygorTO = capacidadeTotal !== 0 ? (ygorCA / capacidadeTotal) * 100 : 0;

                // Armazenar dados calculados para o dashboard
                dadosCalculados = {
                    dia,
                    totais: {
                        faturamento: totalFat,
                        comissao: totalComissao,
                        margemContribuicao: totalMC,
                        despesas: totalDespesas,
                        geracaoCaixa: totalGC,
                        clientesAtendidos: totalCA,
                        ticketMedio: totalTM,
                        taxaOcupacao: totalTO,
                        clientesNovos: totalCN
                    },
                    barbeiros: {
                        victor: {
                            faturamento: victorFat,
                            clientesAtendidos: victorCA,
                            clientesNovos: victorCN,
                            ticketMedio: victorTM,
                            taxaOcupacao: victorTO
                        },
                        fernando: {
                            faturamento: fernandoFat,
                            clientesAtendidos: fernandoCA,
                            clientesNovos: fernandoCN,
                            ticketMedio: fernandoTM,
                            taxaOcupacao: fernandoTO
                        },
                        ygor: {
                            faturamento: ygorFat,
                            comissao: ygorComissao,
                            clientesAtendidos: ygorCA,
                            clientesNovos: ygorCN,
                            ticketMedio: ygorTM,
                            taxaOcupacao: ygorTO
                        }
                    }
                };
                
                // Fun√ß√£o para formatar valores em reais (padr√£o brasileiro)
                function formatarReal(valor) {
                    return valor.toFixed(2).replace('.', ',');
                }
                
                function formatarPercentual(valor) {
                    return valor.toFixed(2).replace('.', ',');
                }
                
                // Formatando resultados
                let resultado = `${dia}\n*_Indicadores 310:_*\n\n`;
                resultado += `Faturamento: R$${formatarReal(totalFat)}\n`;
                resultado += `Comiss√£o: R$${formatarReal(totalComissao)}\n`;
                resultado += `Margem contribui√ß√£o: R$${formatarReal(totalMC)}\n`;
                resultado += `Despesas operacionais: R$${formatarReal(totalDespesas)}\n`;
                resultado += `Gera√ß√£o de caixa: R$${formatarReal(totalGC)}\n`;
                resultado += `Clientes atendidos: ${totalCA}\n`;
                resultado += `Ticket m√©dio: R$${formatarReal(totalTM)}\n`;
                resultado += `Taxa de ocupa√ß√£o: ${formatarPercentual(totalTO)}%\n`;
                resultado += `Clientes novos: ${totalCN}\n`;
                resultado += `_____________________________________________\n`;
                
                resultado += `*_Indicadores Victor:_*\n\n`;
                resultado += `Faturamento: R$${formatarReal(victorFat)}\n`;
                resultado += `Clientes atendidos: ${victorCA}\n`;
                resultado += `Ticket m√©dio: R$${formatarReal(victorTM)}\n`;
                resultado += `Taxa de ocupa√ß√£o: ${formatarPercentual(victorTO)}%\n`;
                resultado += `Clientes novos: ${victorCN}\n`;
                resultado += `_____________________________________________\n`;
                
                resultado += `*_Indicadores Fernando:_*\n\n`;
                resultado += `Faturamento: R$${formatarReal(fernandoFat)}\n`;
                resultado += `Clientes atendidos: ${fernandoCA}\n`;
                resultado += `Ticket m√©dio: R$${formatarReal(fernandoTM)}\n`;
                resultado += `Taxa de ocupa√ß√£o: ${formatarPercentual(fernandoTO)}%\n`;
                resultado += `Clientes novos: ${fernandoCN}\n`;
                resultado += `_____________________________________________\n`;
                
                resultado += `*_Indicadores Ygor:_*\n\n`;
                resultado += `Faturamento: R$${formatarReal(ygorFat)}\n`;
                if (ygorComissao > 0) {
                    resultado += `Comiss√£o: R$${formatarReal(ygorComissao)}\n`;
                }
                resultado += `Clientes atendidos: ${ygorCA}\n`;
                resultado += `Ticket m√©dio: R$${formatarReal(ygorTM)}\n`;
                resultado += `Taxa de ocupa√ß√£o: ${formatarPercentual(ygorTO)}%\n`;
                resultado += `Clientes novos: ${ygorCN}`;
                
                // Exibindo resultado
                document.getElementById('resultados').textContent = resultado;
                document.getElementById('copyBtn').style.display = 'block';
                
                // Armazenando resultado para c√≥pia
                window.resultadoParaCopia = resultado;
                
                // Gerar dashboard
                gerarDashboard();
                
                // Download autom√°tico do PNG
                setTimeout(() => {
                    baixarDashboardPNG();
                }, 1000);
                
                // Remover loading
                btn.classList.remove('loading');
                btn.disabled = false;
                
                // Anunciar sucesso para leitores de tela
                const resultadosElement = document.getElementById('resultados');
                resultadosElement.setAttribute('aria-live', 'assertive');
                setTimeout(() => {
                    resultadosElement.setAttribute('aria-live', 'polite');
                }, 1000);
                
            }, 500); // Delay de 500ms para mostrar loading
        }

        function gerarDashboard() {
            // Mostrar dashboard e esconder formul√°rio
            document.getElementById('inputContent').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            
            // Atualizar data no dashboard
            document.getElementById('dashboardDate').textContent = dadosCalculados.dia;
            
            // Gerar m√©tricas principais
            gerarMetricas();
            
            // Gerar gr√°ficos
            gerarGraficoFaturamento();
            gerarGraficoClientes();
            
            // Gerar cards de performance
            gerarCardsPerformance();
        }

        function gerarMetricas() {
            const metricsGrid = document.getElementById('metricsGrid');
            const dados = dadosCalculados.totais;
            
            const metricas = [
                {
                    titulo: 'Faturamento Total',
                    valor: `R$ ${formatarMoeda(dados.faturamento)}`,
                    subtitulo: 'Receita bruta do dia',
                    classe: dados.faturamento > 1300 ? 'highlight' : dados.faturamento < 250 ? 'warning' : ''
                },
                {
                    titulo: 'Gera√ß√£o de Caixa',
                    valor: `R$ ${formatarMoeda(dados.geracaoCaixa)}`,
                    subtitulo: 'Lucro l√≠quido',
                    classe: dados.geracaoCaixa > 500 ? 'highlight' : dados.geracaoCaixa < 0 ? 'warning' : ''
                },
                {
                    titulo: 'Clientes Atendidos',
                    valor: dados.clientesAtendidos.toString(),
                    subtitulo: 'Total de atendimentos',
                    classe: dados.clientesAtendidos > 30 ? 'highlight' : dados.clientesAtendidos < 10 ? 'warning' : ''
                },
                {
                    titulo: 'Ticket M√©dio',
                    valor: `R$ ${formatarMoeda(dados.ticketMedio)}`,
                    subtitulo: 'Valor m√©dio por cliente',
                    classe: dados.ticketMedio > 40 ? 'highlight' : dados.ticketMedio < 20 ? 'warning' : ''
                },
                {
                    titulo: 'Taxa de Ocupa√ß√£o',
                    valor: `${formatarPercentual(dados.taxaOcupacao)}%`,
                    subtitulo: 'Capacidade utilizada',
                    classe: ''
                },
                {
                    titulo: 'Clientes Novos',
                    valor: dados.clientesNovos.toString(),
                    subtitulo: 'Novos clientes captados',
                    classe: dados.clientesNovos > 3 ? 'highlight' : dados.clientesNovos === 0 ? 'warning' : ''
                }
            ];
            
            metricsGrid.innerHTML = metricas.map(metrica => `
                <div class="metric-card ${metrica.classe}">
                    <div class="metric-title">${metrica.titulo}</div>
                    <div class="metric-value">${metrica.valor}</div>
                    <div class="metric-subtitle">${metrica.subtitulo}</div>
                </div>
            `).join('');
        }

        function gerarGraficoFaturamento() {
            const chart = document.getElementById('faturamentoChart');
            const barbeiros = dadosCalculados.barbeiros;
            
            const maxFaturamento = Math.max(
                barbeiros.victor.faturamento,
                barbeiros.fernando.faturamento,
                barbeiros.ygor.faturamento
            );
            
            const alturaMaxima = 150; // pixels
            
            chart.innerHTML = `
                <div class="bar bar-victor" style="height: ${(barbeiros.victor.faturamento / maxFaturamento) * alturaMaxima}px">
                    <div class="bar-value">R$ ${formatarMoeda(barbeiros.victor.faturamento)}</div>
                    <div class="bar-label">Victor</div>
                </div>
                <div class="bar bar-fernando" style="height: ${(barbeiros.fernando.faturamento / maxFaturamento) * alturaMaxima}px">
                    <div class="bar-value">R$ ${formatarMoeda(barbeiros.fernando.faturamento)}</div>
                    <div class="bar-label">Fernando</div>
                </div>
                <div class="bar bar-ygor" style="height: ${(barbeiros.ygor.faturamento / maxFaturamento) * alturaMaxima}px">
                    <div class="bar-value">R$ ${formatarMoeda(barbeiros.ygor.faturamento)}</div>
                    <div class="bar-label">Ygor</div>
                </div>
            `;
        }

        function gerarGraficoClientes() {
            const chart = document.getElementById('clientesChart');
            const legend = document.getElementById('clientesLegend');
            const barbeiros = dadosCalculados.barbeiros;
            
            const total = barbeiros.victor.clientesAtendidos + barbeiros.fernando.clientesAtendidos + barbeiros.ygor.clientesAtendidos;
            
            if (total === 0) {
                chart.innerHTML = '<div style="text-align: center; color: #bdc3c7; padding: 50px;">Nenhum cliente atendido</div>';
                legend.innerHTML = '';
                return;
            }
            
            const victorPorcentagem = (barbeiros.victor.clientesAtendidos / total) * 100;
            const fernandoPorcentagem = (barbeiros.fernando.clientesAtendidos / total) * 100;
            const ygorPorcentagem = (barbeiros.ygor.clientesAtendidos / total) * 100;
            
            // Calcular √¢ngulos para o gr√°fico de rosca
            const victorAngulo = (victorPorcentagem / 100) * 360;
            const fernandoAngulo = (fernandoPorcentagem / 100) * 360;
            const ygorAngulo = (ygorPorcentagem / 100) * 360;
            
            let anguloAtual = 0;
            const raio = 80;
            const espessura = 30;
            
            function criarSegmento(angulo, cor, anguloInicio) {
                const anguloFim = anguloInicio + angulo;
                const anguloInicioRad = (anguloInicio * Math.PI) / 180;
                const anguloFimRad = (anguloFim * Math.PI) / 180;
                
                const x1 = raio + (raio - espessura) * Math.cos(anguloInicioRad);
                const y1 = raio + (raio - espessura) * Math.sin(anguloInicioRad);
                const x2 = raio + raio * Math.cos(anguloInicioRad);
                const y2 = raio + raio * Math.sin(anguloInicioRad);
                const x3 = raio + raio * Math.cos(anguloFimRad);
                const y3 = raio + raio * Math.sin(anguloFimRad);
                const x4 = raio + (raio - espessura) * Math.cos(anguloFimRad);
                const y4 = raio + (raio - espessura) * Math.sin(anguloFimRad);
                
                const largeArcFlag = angulo > 180 ? 1 : 0;
                
                return `
                    <path d="M ${x1} ${y1} L ${x2} ${y2} A ${raio} ${raio} 0 ${largeArcFlag} 1 ${x3} ${y3} L ${x4} ${y4} A ${raio - espessura} ${raio - espessura} 0 ${largeArcFlag} 0 ${x1} ${y1}" 
                          fill="${cor}" class="donut-segment"/>
                `;
            }
            
            let segmentos = '';
            
            if (victorAngulo > 0) {
                segmentos += criarSegmento(victorAngulo, '#2c3e50', anguloAtual);
                anguloAtual += victorAngulo;
            }
            
            if (fernandoAngulo > 0) {
                segmentos += criarSegmento(fernandoAngulo, '#7f8c8d', anguloAtual);
                anguloAtual += fernandoAngulo;
            }
            
            if (ygorAngulo > 0) {
                segmentos += criarSegmento(ygorAngulo, '#ecf0f1', anguloAtual);
            }
            
            chart.innerHTML = `
                <svg width="200" height="200" viewBox="0 0 160 160">
                    ${segmentos}
                </svg>
                <div class="donut-center">
                    <div class="donut-center-value">${total}</div>
                    <div class="donut-center-label">Total</div>
                </div>
            `;
            
            legend.innerHTML = `
                ${barbeiros.victor.clientesAtendidos > 0 ? `
                    <div class="legend-item">
                        <div class="legend-color" style="background: #2c3e50;"></div>
                        <span>Victor (${barbeiros.victor.clientesAtendidos})</span>
                    </div>
                ` : ''}
                ${barbeiros.fernando.clientesAtendidos > 0 ? `
                    <div class="legend-item">
                        <div class="legend-color" style="background: #7f8c8d;"></div>
                        <span>Fernando (${barbeiros.fernando.clientesAtendidos})</span>
                    </div>
                ` : ''}
                ${barbeiros.ygor.clientesAtendidos > 0 ? `
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ecf0f1;"></div>
                        <span>Ygor (${barbeiros.ygor.clientesAtendidos})</span>
                    </div>
                ` : ''}
            `;
        }

        function gerarCardsPerformance() {
            const performanceGrid = document.getElementById('performanceGrid');
            const barbeiros = dadosCalculados.barbeiros;
            
            performanceGrid.innerHTML = `
                <div class="performance-card victor">
                    <div class="performance-name">Victor</div>
                    <div class="performance-metric">
                        <span class="performance-label">Faturamento:</span>
                        <span class="performance-value">R$ ${formatarMoeda(barbeiros.victor.faturamento)}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Clientes:</span>
                        <span class="performance-value">${barbeiros.victor.clientesAtendidos}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Ticket M√©dio:</span>
                        <span class="performance-value">R$ ${formatarMoeda(barbeiros.victor.ticketMedio)}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Taxa Ocupa√ß√£o:</span>
                        <span class="performance-value">${formatarPercentual(barbeiros.victor.taxaOcupacao)}%</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Novos Clientes:</span>
                        <span class="performance-value">${barbeiros.victor.clientesNovos}</span>
                    </div>
                </div>
                
                <div class="performance-card fernando">
                    <div class="performance-name">Fernando</div>
                    <div class="performance-metric">
                        <span class="performance-label">Faturamento:</span>
                        <span class="performance-value">R$ ${formatarMoeda(barbeiros.fernando.faturamento)}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Clientes:</span>
                        <span class="performance-value">${barbeiros.fernando.clientesAtendidos}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Ticket M√©dio:</span>
                        <span class="performance-value">R$ ${formatarMoeda(barbeiros.fernando.ticketMedio)}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Taxa Ocupa√ß√£o:</span>
                        <span class="performance-value">${formatarPercentual(barbeiros.fernando.taxaOcupacao)}%</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Novos Clientes:</span>
                        <span class="performance-value">${barbeiros.fernando.clientesNovos}</span>
                    </div>
                </div>
                
                <div class="performance-card ygor">
                    <div class="performance-name">Ygor</div>
                    <div class="performance-metric">
                        <span class="performance-label">Faturamento:</span>
                        <span class="performance-value">R$ ${formatarMoeda(barbeiros.ygor.faturamento)}</span>
                    </div>
                    ${barbeiros.ygor.comissao > 0 ? `
                        <div class="performance-metric">
                            <span class="performance-label">Comiss√£o:</span>
                            <span class="performance-value">R$ ${formatarMoeda(barbeiros.ygor.comissao)}</span>
                        </div>
                    ` : ''}
                    <div class="performance-metric">
                        <span class="performance-label">Clientes:</span>
                        <span class="performance-value">${barbeiros.ygor.clientesAtendidos}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Ticket M√©dio:</span>
                        <span class="performance-value">R$ ${formatarMoeda(barbeiros.ygor.ticketMedio)}</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Taxa Ocupa√ß√£o:</span>
                        <span class="performance-value">${formatarPercentual(barbeiros.ygor.taxaOcupacao)}%</span>
                    </div>
                    <div class="performance-metric">
                        <span class="performance-label">Novos Clientes:</span>
                        <span class="performance-value">${barbeiros.ygor.clientesNovos}</span>
                    </div>
                </div>
            `;
        }

        function voltarFormulario() {
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('inputContent').style.display = 'grid';
        }

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatarPercentual(valor) {
            return valor.toFixed(1);
        }
        
        // Fun√ß√£o para c√≥pia autom√°tica (silenciosa)
        async function copiarAutomaticamente(texto) {
            try {
                await navigator.clipboard.writeText(texto);
                
                // Feedback visual discreto no bot√£o
                const copyBtn = document.getElementById('copyBtn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copiado Automaticamente!';
                copyBtn.classList.add('copy-success');
                
                setTimeout(() => {
                    copyBtn.textContent = 'üìã Copiar Novamente';
                    copyBtn.classList.remove('copy-success');
                }, 3000);
                
            } catch (err) {
                // Fallback silencioso para navegadores mais antigos
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = texto;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    // Feedback visual discreto
                    const copyBtn = document.getElementById('copyBtn');
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = '‚úÖ Copiado Automaticamente!';
                    copyBtn.classList.add('copy-success');
                    
                    setTimeout(() => {
                        copyBtn.textContent = 'üìã Copiar Novamente';
                        copyBtn.classList.remove('copy-success');
                    }, 3000);
                    
                } catch (fallbackErr) {
                    // Se falhar completamente, manter bot√£o normal
                    console.log('C√≥pia autom√°tica n√£o dispon√≠vel neste navegador');
                }
            }
        }

        async function copiarResultados() {
            const copyBtn = document.getElementById('copyBtn');
            copyBtn.classList.add('loading');
            copyBtn.disabled = true;
            
            try {
                await navigator.clipboard.writeText(window.resultadoParaCopia);
                
                // Feedback visual
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copiado!';
                copyBtn.classList.add('copy-success');
                copyBtn.classList.remove('loading');
                copyBtn.disabled = false;
                
                setTimeout(() => {
                    copyBtn.textContent = 'üìã Copiar Novamente';
                    copyBtn.classList.remove('copy-success');
                }, 2000);
                
            } catch (err) {
                // Fallback para navegadores mais antigos
                const textArea = document.createElement('textarea');
                textArea.value = window.resultadoParaCopia;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Feedback visual
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copiado!';
                copyBtn.classList.add('copy-success');
                copyBtn.classList.remove('loading');
                copyBtn.disabled = false;
                
                setTimeout(() => {
                    copyBtn.textContent = 'üìã Copiar Novamente';
                    copyBtn.classList.remove('copy-success');
                }, 2000);
            }
        }
        
        // Fun√ß√£o para alternar tema
        function alternarTema() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const isLightTheme = body.classList.contains('light-theme');
            
            if (isLightTheme) {
                body.classList.remove('light-theme');
                themeIcon.textContent = 'üåô';
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.add('light-theme');
                themeIcon.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'light');
            }
        }
        
        // Fun√ß√£o simples para adicionar √† tela inicial
        function adicionarTelaInicial() {
            if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('iPad')) {
                alert('Para adicionar √† tela inicial:\n1. Toque no √≠cone de compartilhar (‚ñ°‚Üó)\n2. Selecione "Adicionar √† Tela de In√≠cio"');
            } else if (navigator.userAgent.includes('Android')) {
                alert('Para adicionar √† tela inicial:\n1. Toque no menu (‚ãÆ)\n2. Selecione "Adicionar √† tela inicial"');
            } else {
                alert('Para acesso r√°pido, adicione este site aos seus favoritos!');
            }
        }

        // Adicionar listeners para Enter nos inputs e preencher data automaticamente
        document.addEventListener('DOMContentLoaded', function() {
            // Preencher automaticamente com a data de hoje
            const hoje = new Date();
            const dia = String(hoje.getDate()).padStart(2, '0');
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            document.getElementById('dia').value = `${dia}/${mes}`;
            
            // Definir ordem dos campos para navega√ß√£o
            const ordemCampos = [
                'dia',
                'victorFat',
                'victorCA', 
                'victorCN',
                'fernandoFat',
                'fernandoCA',
                'fernandoCN',
                'ygorFat',
                'ygorComissao',
                'ygorCA',
                'ygorCN',
                'totalDespesas'
            ];
            
            // Adicionar listener espec√≠fico para o campo de faturamento do Ygor
            document.getElementById('ygorFat').addEventListener('input', function() {
                calcularComissaoYgor();
            });
            
            // Tamb√©m calcular quando o campo perde o foco
            document.getElementById('ygorFat').addEventListener('blur', function() {
                calcularComissaoYgor();
            });

            const inputs = document.querySelectorAll('input');
            inputs.forEach((input, index) => {
                // Listener para Enter - navegar para pr√≥ximo campo
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        
                        const campoAtual = this.id;
                        const indiceCampoAtual = ordemCampos.indexOf(campoAtual);
                        
                        // Se √© o √∫ltimo campo, calcular indicadores
                        if (indiceCampoAtual === ordemCampos.length - 1) {
                            calcularIndicadores();
                        } else {
                            // Ir para o pr√≥ximo campo
                            const proximoCampo = ordemCampos[indiceCampoAtual + 1];
                            const proximoInput = document.getElementById(proximoCampo);
                            if (proximoInput) {
                                proximoInput.focus();
                                proximoInput.select(); // Selecionar texto para facilitar substitui√ß√£o
                            }
                        }
                    }
                });
                
                // Valida√ß√£o em tempo real
                input.addEventListener('blur', function() {
                    const campo = this.id;
                    const valor = this.value;
                    
                    // Determinar tipo de valida√ß√£o
                    let tipo = 'number';
                    let max = 999999;
                    
                    if (campo === 'dia') {
                        tipo = 'date';
                    } else if (campo.includes('CA') || campo.includes('CN')) {
                        max = 1000;
                    }
                    
                    validarCampo(campo, valor, tipo, 0, max);
                });
                
                // Limpar erros ao come√ßar a digitar
                input.addEventListener('input', function() {
                    const errorElement = document.getElementById(this.id + '-error');
                    if (errorElement.style.display === 'block') {
                        errorElement.style.display = 'none';
                        this.classList.remove('input-error');
                        this.setAttribute('aria-invalid', 'false');
                    }
                });
                
                // Adicionar indica√ß√£o visual de qual campo est√° ativo
                input.addEventListener('focus', function() {
                    this.style.boxShadow = '0 0 20px rgba(204, 204, 204, 0.6)';
                    this.style.borderColor = '#ffffff';
                });
                
                input.addEventListener('blur', function() {
                    this.style.boxShadow = '';
                    this.style.borderColor = '#888888';
                });
            });
            
            // Adicionar suporte a teclado para bot√µes
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
            
            // Focar no primeiro campo ao carregar a p√°gina
            setTimeout(() => {
                document.getElementById('dia').focus();
            }, 100);
            
            // Carregar tema salvo
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
            }
        });

        // Fun√ß√£o para baixar dashboard como PNG
        async function baixarDashboardPNG() {
            const downloadBtn = document.querySelector('.download-btn');
            const originalText = downloadBtn.textContent;
            
            // Mostrar loading
            downloadBtn.classList.add('loading');
            downloadBtn.textContent = 'Gerando imagem...';
            downloadBtn.disabled = true;
            
            try {
                // Criar um canvas para capturar o dashboard
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Configurar dimens√µes do canvas otimizadas
                const scale = 2; // Para melhor qualidade
                const canvasWidth = 1000;
                const canvasHeight = 1200; // Otimizado para conte√∫do essencial
                canvas.width = canvasWidth * scale;
                canvas.height = canvasHeight * scale;
                ctx.scale(scale, scale);
                
                // Definir fundo baseado no tema atual
                const isLightTheme = document.body.classList.contains('light-theme');
                ctx.fillStyle = isLightTheme ? '#f8f9fa' : '#4a4a4a';
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                
                // Cores baseadas no tema
                const textColor = isLightTheme ? '#2c3e50' : '#f0f0f0';
                const subtitleColor = isLightTheme ? '#6c757d' : '#bdc3c7';
                const cardBg = isLightTheme ? 'rgba(255, 255, 255, 0.9)' : 'rgba(70, 70, 70, 0.9)';
                const cardBorder = isLightTheme ? '#dee2e6' : '#888888';
                
                // Desenhar conte√∫do do dashboard com layout compacto
                let currentY = 30;
                const padding = 25;
                const cardWidth = (canvasWidth - padding * 4) / 3;
                
                // T√≠tulo principal
                ctx.fillStyle = textColor;
                ctx.font = 'bold 28px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(dadosCalculados.dia, canvasWidth / 2, currentY);
                
                currentY += 30;
                ctx.font = '16px "Segoe UI", sans-serif';
                ctx.fillText('Dashboard de Indicadores - 310 Barber', canvasWidth / 2, currentY);
                
                currentY += 45;
                ctx.textAlign = 'left';
                
                // M√©tricas principais
                const metricas = [
                    { titulo: 'Faturamento Total', valor: `R$ ${formatarMoeda(dadosCalculados.totais.faturamento)}` },
                    { titulo: 'Gera√ß√£o de Caixa', valor: `R$ ${formatarMoeda(dadosCalculados.totais.geracaoCaixa)}` },
                    { titulo: 'Clientes Atendidos', valor: dadosCalculados.totais.clientesAtendidos.toString() },
                    { titulo: 'Ticket M√©dio', valor: `R$ ${formatarMoeda(dadosCalculados.totais.ticketMedio)}` },
                    { titulo: 'Taxa de Ocupa√ß√£o', valor: `${formatarPercentual(dadosCalculados.totais.taxaOcupacao)}%` },
                    { titulo: 'Clientes Novos', valor: dadosCalculados.totais.clientesNovos.toString() }
                ];
                
                // Desenhar m√©tricas em grid compacto com cores
                for (let i = 0; i < metricas.length; i++) {
                    const col = i % 3;
                    const row = Math.floor(i / 3);
                    const x = padding + col * (cardWidth + padding);
                    const y = currentY + row * 100;
                    
                    // Determinar cor do indicador baseado no valor
                    let corIndicador = cardBorder; // Cor padr√£o
                    let corValor = textColor; // Cor padr√£o do texto
                    
                    if (i === 0) { // Faturamento Total
                        if (dadosCalculados.totais.faturamento > 1300) {
                            corIndicador = '#27ae60'; // Verde
                            corValor = '#27ae60';
                        } else if (dadosCalculados.totais.faturamento >= 250) {
                            corIndicador = cardBorder; // Normal
                            corValor = textColor;
                        } else {
                            corIndicador = '#e74c3c'; // Vermelho
                            corValor = '#e74c3c';
                        }
                    } else if (i === 1) { // Gera√ß√£o de Caixa
                        if (dadosCalculados.totais.geracaoCaixa > 500) {
                            corIndicador = '#27ae60'; // Verde
                            corValor = '#27ae60';
                        } else if (dadosCalculados.totais.geracaoCaixa >= 0) {
                            corIndicador = cardBorder; // Normal
                            corValor = textColor;
                        } else {
                            corIndicador = '#e74c3c'; // Vermelho
                            corValor = '#e74c3c';
                        }
                    } else if (i === 2) { // Clientes Atendidos
                        if (dadosCalculados.totais.clientesAtendidos > 30) {
                            corIndicador = '#27ae60'; // Verde
                            corValor = '#27ae60';
                        } else if (dadosCalculados.totais.clientesAtendidos >= 10) {
                            corIndicador = cardBorder; // Normal
                            corValor = textColor;
                        } else {
                            corIndicador = '#e74c3c'; // Vermelho
                            corValor = '#e74c3c';
                        }
                    } else if (i === 3) { // Ticket M√©dio
                        if (dadosCalculados.totais.ticketMedio > 40) {
                            corIndicador = '#27ae60'; // Verde
                            corValor = '#27ae60';
                        } else if (dadosCalculados.totais.ticketMedio >= 20) {
                            corIndicador = cardBorder; // Normal
                            corValor = textColor;
                        } else {
                            corIndicador = '#e74c3c'; // Vermelho
                            corValor = '#e74c3c';
                        }
                    } else if (i === 4) { // Taxa de Ocupa√ß√£o - mant√©m crit√©rio original
                        corIndicador = cardBorder; // Normal
                        corValor = textColor;
                    } else if (i === 5) { // Clientes Novos
                        if (dadosCalculados.totais.clientesNovos > 3) {
                            corIndicador = '#27ae60'; // Verde
                            corValor = '#27ae60';
                        } else if (dadosCalculados.totais.clientesNovos > 0) {
                            corIndicador = cardBorder; // Normal
                            corValor = textColor;
                        } else {
                            corIndicador = '#e74c3c'; // Vermelho
                            corValor = '#e74c3c';
                        }
                    }
                    
                    // Fundo do card
                    ctx.fillStyle = cardBg;
                    ctx.fillRect(x, y, cardWidth, 85);
                    
                    // Borda colorida do indicador (esquerda)
                    ctx.fillStyle = corIndicador;
                    ctx.fillRect(x, y, 4, 85);
                    
                    // Borda do card
                    ctx.strokeStyle = cardBorder;
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, cardWidth, 85);
                    
                    // T√≠tulo da m√©trica
                    ctx.fillStyle = subtitleColor;
                    ctx.font = '11px "Segoe UI", sans-serif';
                    ctx.fillText(metricas[i].titulo.toUpperCase(), x + 12, y + 20);
                    
                    // Valor da m√©trica com cor do indicador
                    ctx.fillStyle = corValor;
                    ctx.font = 'bold 20px "Segoe UI", sans-serif';
                    ctx.fillText(metricas[i].valor, x + 12, y + 50);
                }
                
                currentY += 230;
                
                // SE√á√ÉO DE GR√ÅFICOS
                ctx.fillStyle = textColor;
                ctx.font = 'bold 18px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('An√°lise Visual', canvasWidth / 2, currentY);
                
                currentY += 35;
                
                // √Årea dos gr√°ficos compacta
                const chartWidth = (canvasWidth - padding * 3) / 2;
                const chartHeight = 200;
                
                // GR√ÅFICO DE BARRAS - Faturamento por Barbeiro
                const barChartX = padding;
                const barChartY = currentY;
                
                // Fundo do gr√°fico de barras
                ctx.fillStyle = cardBg;
                ctx.fillRect(barChartX, barChartY, chartWidth, chartHeight);
                ctx.strokeStyle = cardBorder;
                ctx.lineWidth = 1;
                ctx.strokeRect(barChartX, barChartY, chartWidth, chartHeight);
                
                // T√≠tulo do gr√°fico de barras
                ctx.fillStyle = textColor;
                ctx.font = 'bold 16px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Faturamento por Barbeiro', barChartX + chartWidth / 2, barChartY + 25);
                
                // Desenhar barras
                const barbeiros = dadosCalculados.barbeiros;
                const maxFaturamento = Math.max(
                    barbeiros.victor.faturamento,
                    barbeiros.fernando.faturamento,
                    barbeiros.ygor.faturamento
                );
                
                if (maxFaturamento > 0) {
                    const barAreaHeight = 120;
                    const barAreaY = barChartY + 40;
                    const barWidth = 60;
                    const barSpacing = (chartWidth - padding * 2 - barWidth * 3) / 2;
                    
                    const barData = [
                        { nome: 'Victor', valor: barbeiros.victor.faturamento, cor: '#2c3e50' },
                        { nome: 'Fernando', valor: barbeiros.fernando.faturamento, cor: '#7f8c8d' },
                        { nome: 'Ygor', valor: barbeiros.ygor.faturamento, cor: '#ecf0f1' }
                    ];
                    
                    barData.forEach((bar, index) => {
                        const barHeight = (bar.valor / maxFaturamento) * barAreaHeight;
                        const barX = barChartX + padding + index * (barWidth + barSpacing);
                        const barY = barAreaY + barAreaHeight - barHeight;
                        
                        // Desenhar barra
                        ctx.fillStyle = bar.cor;
                        ctx.fillRect(barX, barY, barWidth, barHeight);
                        
                        // Valor acima da barra
                        ctx.fillStyle = textColor;
                        ctx.font = '10px "Segoe UI", sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(`R$ ${formatarMoeda(bar.valor)}`, barX + barWidth / 2, barY - 5);
                        
                        // Nome abaixo da barra
                        ctx.fillText(bar.nome, barX + barWidth / 2, barAreaY + barAreaHeight + 15);
                    });
                }
                
                // GR√ÅFICO DE ROSCA - Distribui√ß√£o de Clientes
                const donutChartX = padding * 2 + chartWidth;
                const donutChartY = currentY;
                
                // Fundo do gr√°fico de rosca
                ctx.fillStyle = cardBg;
                ctx.fillRect(donutChartX, donutChartY, chartWidth, chartHeight);
                ctx.strokeStyle = cardBorder;
                ctx.lineWidth = 1;
                ctx.strokeRect(donutChartX, donutChartY, chartWidth, chartHeight);
                
                // T√≠tulo do gr√°fico de rosca
                ctx.fillStyle = textColor;
                ctx.font = 'bold 16px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Distribui√ß√£o de Clientes', donutChartX + chartWidth / 2, donutChartY + 25);
                
                // Desenhar gr√°fico de rosca
                const totalClientes = barbeiros.victor.clientesAtendidos + barbeiros.fernando.clientesAtendidos + barbeiros.ygor.clientesAtendidos;
                
                if (totalClientes > 0) {
                    const centerX = donutChartX + chartWidth / 2;
                    const centerY = donutChartY + 100;
                    const outerRadius = 50;
                    const innerRadius = 30;
                    
                    const clientesData = [
                        { nome: 'Victor', valor: barbeiros.victor.clientesAtendidos, cor: '#2c3e50' },
                        { nome: 'Fernando', valor: barbeiros.fernando.clientesAtendidos, cor: '#7f8c8d' },
                        { nome: 'Ygor', valor: barbeiros.ygor.clientesAtendidos, cor: '#ecf0f1' }
                    ];
                    
                    let currentAngle = -Math.PI / 2; // Come√ßar do topo
                    
                    clientesData.forEach(cliente => {
                        if (cliente.valor > 0) {
                            const sliceAngle = (cliente.valor / totalClientes) * 2 * Math.PI;
                            
                            // Desenhar fatia
                            ctx.beginPath();
                            ctx.arc(centerX, centerY, outerRadius, currentAngle, currentAngle + sliceAngle);
                            ctx.arc(centerX, centerY, innerRadius, currentAngle + sliceAngle, currentAngle, true);
                            ctx.closePath();
                            ctx.fillStyle = cliente.cor;
                            ctx.fill();
                            
                            currentAngle += sliceAngle;
                        }
                    });
                    
                    // Texto central
                    ctx.fillStyle = textColor;
                    ctx.font = 'bold 20px "Segoe UI", sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(totalClientes.toString(), centerX, centerY - 5);
                    ctx.font = '12px "Segoe UI", sans-serif';
                    ctx.fillText('Total', centerX, centerY + 15);
                    
                    // Legenda
                    let legendY = donutChartY + 160;
                    ctx.font = '10px "Segoe UI", sans-serif';
                    ctx.textAlign = 'left';
                    
                    clientesData.forEach((cliente, index) => {
                        if (cliente.valor > 0) {
                            const legendX = donutChartX + 20 + (index * 120);
                            
                            // Quadrado colorido
                            ctx.fillStyle = cliente.cor;
                            ctx.fillRect(legendX, legendY - 8, 12, 12);
                            
                            // Texto da legenda
                            ctx.fillStyle = textColor;
                            ctx.fillText(`${cliente.nome} (${cliente.valor})`, legendX + 18, legendY);
                        }
                    });
                }
                
                currentY += 240;
                
                // Performance individual
                ctx.fillStyle = textColor;
                ctx.font = 'bold 18px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Performance Individual', canvasWidth / 2, currentY);
                
                currentY += 35;
                ctx.textAlign = 'left';
                
                const barbeirosNomes = ['victor', 'fernando', 'ygor'];
                const nomesBarbeiros = ['Victor', 'Fernando', 'Ygor'];
                
                for (let i = 0; i < barbeirosNomes.length; i++) {
                    const barbeiro = barbeirosNomes[i];
                    const nome = nomesBarbeiros[i];
                    const dados = dadosCalculados.barbeiros[barbeiro];
                    
                    const x = padding + i * (cardWidth + padding);
                    const y = currentY;
                    
                    // Fundo do card
                    ctx.fillStyle = cardBg;
                    ctx.fillRect(x, y, cardWidth, 150);
                    
                    // Borda colorida
                    const cores = { victor: '#2c3e50', fernando: '#7f8c8d', ygor: '#ecf0f1' };
                    ctx.fillStyle = cores[barbeiro];
                    ctx.fillRect(x, y, 4, 150);
                    
                    // Borda do card
                    ctx.strokeStyle = cardBorder;
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, cardWidth, 150);
                    
                    // Nome do barbeiro
                    ctx.fillStyle = textColor;
                    ctx.font = 'bold 14px "Segoe UI", sans-serif';
                    ctx.fillText(nome, x + 12, y + 22);
                    
                    // M√©tricas do barbeiro
                    let metricY = y + 42;
                    const metricas = [
                        `Faturamento: R$ ${formatarMoeda(dados.faturamento)}`,
                        `Clientes: ${dados.clientesAtendidos}`,
                        `Ticket M√©dio: R$ ${formatarMoeda(dados.ticketMedio)}`,
                        `Taxa Ocupa√ß√£o: ${formatarPercentual(dados.taxaOcupacao)}%`,
                        `Novos Clientes: ${dados.clientesNovos}`
                    ];
                    
                    if (barbeiro === 'ygor' && dados.comissao > 0) {
                        metricas.splice(1, 0, `Comiss√£o: R$ ${formatarMoeda(dados.comissao)}`);
                    }
                    
                    ctx.font = '10px "Segoe UI", sans-serif';
                    ctx.fillStyle = textColor;
                    
                    metricas.forEach(metrica => {
                        ctx.fillText(metrica, x + 12, metricY);
                        metricY += 16;
                    });
                }
                
                // Converter canvas para blob e baixar
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `dashboard-310-barber-${dadosCalculados.dia.replace('/', '-')}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // Restaurar bot√£o
                    downloadBtn.classList.remove('loading');
                    downloadBtn.textContent = '‚úÖ Download Conclu√≠do!';
                    downloadBtn.disabled = false;
                    
                    setTimeout(() => {
                        downloadBtn.textContent = originalText;
                    }, 3000);
                }, 'image/png', 0.95);
                
            } catch (error) {
                console.error('Erro ao gerar imagem:', error);
                
                // Restaurar bot√£o em caso de erro
                downloadBtn.classList.remove('loading');
                downloadBtn.textContent = '‚ùå Erro no Download';
                downloadBtn.disabled = false;
                
                setTimeout(() => {
                    downloadBtn.textContent = originalText;
                }, 3000);
                
                // Mostrar mensagem de erro amig√°vel
                alert('N√£o foi poss√≠vel gerar a imagem. Tente usar a fun√ß√£o de captura de tela do seu dispositivo.');
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97685361434ee0f9',t:'MTc1NjQzMTQ3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>